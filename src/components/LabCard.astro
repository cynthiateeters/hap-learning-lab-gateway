---
/**
 * LabCard.astro - Card component for linking to HAP Learning Labs, Projects, Podcasts, and Videos
 *
 * Displays a card with content information, status badge, and metadata.
 * Supports Learning Labs (with stations), Practice Projects, Podcasts, and Videos.
 */

interface Props {
  slug?: string;
  order?: number;
  icon: string;
  title: string;
  description: string;
  url?: string;
  stationCount?: number;
  difficulty?: 'Beginner' | 'Intermediate' | 'Advanced';
  status?: 'live' | 'coming-soon';
  cardType?: 'lab' | 'project' | 'podcast' | 'video';
  duration?: string;
  showName?: string;
}

const { slug, icon, title, description, url, stationCount = 6, difficulty, status = 'live', cardType = 'lab', duration, showName } = Astro.props;

const isLive = status === 'live' && url;
const isProject = cardType === 'project';
const isPodcast = cardType === 'podcast';
const isVideo = cardType === 'video';

const ctaText = isProject ? '→ View Project'
              : isPodcast ? '→ Listen on Spotify'
              : isVideo ? '→ Watch on YouTube'
              : '→ Visit Lab';

const typeLabel = isProject ? 'Practice Project'
                : isPodcast ? (showName || 'Podcast')
                : isVideo ? (duration || 'Video')
                : `${stationCount} stations`;
---

{
  isLive ? (
    <div id={slug} class='insight-card lab-card'>
      <div class='lab-card-header'>
        <h3>
          <span class='insight-icon'>{icon}</span> {title}
        </h3>
        {isProject && <span class='lab-badge lab-badge-project'>Project</span>}
        {isPodcast && <span class='lab-badge lab-badge-podcast'>Podcast</span>}
        {isVideo && <span class='lab-badge lab-badge-video'>Video</span>}
      </div>
      <p class='lab-description'>{description}</p>
      <div class='lab-meta'>
        <span class='lab-meta-item'>{typeLabel}</span>
        {isPodcast && duration && <span class='lab-meta-item'>{duration}</span>}
        {difficulty && <span class='lab-meta-item'>{difficulty}</span>}
      </div>
      <a href={url} class='lab-cta-link'>
        {ctaText}
      </a>
    </div>
  ) : (
    <div id={slug} class='insight-card lab-card lab-card-coming-soon'>
      <div class='lab-card-header'>
        <h3>
          <span class='insight-icon'>{icon}</span> {title}
        </h3>
        <span class='lab-badge'>Coming Soon</span>
      </div>
      <p class='lab-description'>{description}</p>
      <div class='lab-meta'>
        <span class='lab-meta-item'>{typeLabel}</span>
        <span class='lab-meta-item'>{difficulty}</span>
      </div>
    </div>
  )
}

<style>
  .lab-card {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  .lab-card-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 1rem;
  }

  .lab-card-header h3 {
    margin: 0;
  }

  .lab-badge {
    background: hsl(32, 76%, 30%);
    color: hsl(0, 0%, 100%);
    padding: 0.25rem 0.75rem;
    border-radius: 100px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    white-space: nowrap;
  }

  .lab-badge-project {
    background: hsl(168, 34%, 30%);
  }

  .lab-badge-podcast {
    background: hsl(141, 73%, 24%);
  }

  .lab-badge-video {
    background: hsl(0, 70%, 38%);
  }

  .lab-description {
    flex: 1;
    margin: 0;
  }

  .lab-meta {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
  }

  .lab-meta-item {
    font-size: 0.875rem;
    color: hsl(22, 22%, 34%);
  }

  .lab-card-coming-soon {
    cursor: default;
  }

  .lab-card-coming-soon .lab-card-header h3,
  .lab-card-coming-soon .lab-description,
  .lab-card-coming-soon .lab-meta {
    opacity: 0.9;
  }

  .lab-card-coming-soon:hover {
    transform: none;
    border-color: transparent;
  }

  .lab-cta-link {
    display: inline-block;
    color: hsl(32, 76%, 37%);
    font-weight: 600;
    text-decoration: none;
    margin-top: auto;
  }

  .lab-cta-link:hover {
    text-decoration: underline;
    color: hsl(32, 76%, 27%);
  }

  /* Anchor link support - ensure card isn't hidden under sticky headers */
  .lab-card[id] {
    scroll-margin-top: 6rem;
  }

  /* Highlight effect when navigated to via anchor link */
  .lab-card:target {
    animation: highlight-pulse 2s ease-out;
    box-shadow: 0 0 0 3px hsl(32, 76%, 37%);
  }

  @keyframes highlight-pulse {
    0% {
      box-shadow: 0 0 0 6px hsl(35, 83%, 74%);
    }
    100% {
      box-shadow: 0 0 0 3px hsl(32, 76%, 37%);
    }
  }
</style>
